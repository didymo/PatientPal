<mat-spinner mode="indeterminate" id="spinner" *ngIf="!tabView"></mat-spinner>
<!--<mat-progress-bar id="spinner" mode="indeterminate" ></mat-progress-bar>-->

<ng-template #content let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Change Assessment Order</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="orderInput">Assessment Order</label>
          <div class="input-group">
            <input id="orderInput"
                [(ngModel)]="AssessmentOrder"
                [ngModelOptions]="{standalone: true}"
                (ngModelChange)="changeValue()"
                type="number"
                class="form-control"
                placeholder="Assessment Order Number"
                name="dp">
          </div>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Save</button>
    </div>
  </ng-template>


<div class="navigation" *ngIf="tabView">
    <button class="btn toolbar-item" routerLink="/tab-views">
        Return
    </button>
    <button class="btn btn-light toolbar-item" id="exp-btn1" (click)="setPreview()"
            checked="false"
            [disabled]=previewDisabled>
        Preview
    </button>

    <button class="btn toolbar-item" (click)="submit()">
        Save
    </button>

    <button class="btn toolbar-item" (click)="publish()">
        Publish
    </button>
    <button class="btn btn-light toolbar-item" (click)="exportAsXLSX()">
        Export
    </button>
    <button class="btn btn-light toolbar-item" id="exp-btn" (click)="deploy()">
        Deploy
    </button>
    <button
            *ngIf="innerWidth > 765"
            class="btn btn-light toolbar-item"
            [disabled]="disabled"
            (click)="setToggle()"
            id="livePreview"
            color="primary">
        Live Preview
    </button>
    <!--    <button class="btn toolbar-item" (click)="openBeta(content)">-->
    <!--        Beta-->
    <!--    </button>-->
    <div class="col-lg-7 toolbar-title" *ngIf="tabView">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">Survey Title</span>
            </div>
            <input type="text" class="form-control" id="surveyTitle" [value]="tabView.tabViewLabel" style="font-weight: bold">
        </div>
    </div>

</div>
<br>
<div>
    <div id="wrapper" *ngIf="tabView">
        <div id="questions"
             [@openPreview]="isPreview ? 'hideEdit' : 'visible'"
             [@openClose]="isOpen ? 'open' : 'closed'"
             [@fullPreview]="isPreview ? 'open': 'closed'"
             class="open-close-container">
            <cdk-virtual-scroll-viewport style="height: 87vh" itemSize="90">
                <form (ngSubmit)="saveSurvey()" id="form">
                    <div class="assessment-list" >
                        <div *ngFor="let assessments of tabView.assessments; let i = index" id="assessments"
                             class="assessment-item" >
                            <div class="title-div">
                                <div [ngSwitch]="assessments.assessmentDisplayType">
                                    <div class="imgView" *ngSwitchCase="'SelectOne'">
                                        <img src="assets/icons/select.png" width="24" height="24" class="rounded float-left"
                                             alt="">
                                    </div>
                                    <div class="imgView" *ngSwitchCase="'Radio'">
                                        <img src="assets/icons/radiobtn.png" width="24" height="24" class="rounded float-left"
                                             alt="">
                                    </div>
                                    <div class="imgView" *ngSwitchCase="'SelectMany'">
                                        <img src="assets/icons/SelectMany.png" width="24" height="24" class="rounded float-left"
                                             alt="">
                                    </div>
                                    <div class="imgView" *ngSwitchCase="'Number'">
                                        <img src="assets/icons/Number.png" width="24" height="24" class="rounded float-left"
                                             alt="">
                                    </div>
                                    <div class="imgView" *ngSwitchCase="'Text'">
                                        <img src="assets/icons/texts.png" width="24" height="24" class="rounded float-left"
                                             alt="">
                                    </div>
                                </div>
                                <div class="title-div-child1">
                                    <p style="font-weight: bold">{{i + 1}}.</p>
                                </div>
                                <div class="title-div-child2">
                                    <input class="form-control"
                                           [value]="assessments.assessmentDescription"
                                           [(ngModel)]="assessments.assessmentDescription"
                                           (ngModelChange)="preview.changeTitle(i,$event)"
                                           [ngModelOptions]="{standalone: true}"
                                           [attr.id]=assessments.assessmentId style="font-weight: bold">
                                </div>
                            </div>

                            <!--Assessment 5-->
                            <div id="ass5" *ngIf="assessments.assessmentType.toString() === '5'">

                                <div id="option-div-parent1" *ngFor="let choices of assessments.assessmentChoices let x = index">
                                    <div id="option-div-child">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Option {{x + 1}}</span>
                                        </div>
                                        <textarea
                                                [(ngModel)]="choices.choiceDescription"
                                                [ngModelOptions]="{standalone: true}"
                                                (ngModelChange)="saveQuestion(i, x, false, i)"
                                                [value]="choices.choiceDescription"
                                                [attr.id]=choices.choiceId
                                                class="form-control" rows="2"
                                        >
                                </textarea>
                                    </div>
                                </div>
                                <div id="btn-div-1">

                                    <div class="submit-child">
                                        <div [ngSwitch]="assessments.assessmentRequired">
                                            <button id="mandatory1" class="btn btn-primary" *ngSwitchCase="1" (click)="handleValidation('1', i)">
                                                Mandatory
                                            </button>
                                            <button id="optional1" class="btn btn-primary" *ngSwitchCase="0" (click)="handleValidation('0', i)">
                                                Optional
                                            </button>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary modal-order" (click)="open(content, i)" >
                                        Order
                                    </button>
                                    <div ngbDropdown placement="top-right" class="d-inline-block">
                                        <button class="btn btn-primary" id="dropdownBasic1" ngbDropdownToggle>Toggle
                                            dropdown
                                        </button>
                                        <select name="dropdownBasic1" [(ngModel)]="assessments.assessmentDisplayType">
                                            <option value="Radio">Radio Buttons</option>
                                            <option value="DistressThermometer">Distress Thermometer</option>
                                            <!--
                                            [ { title: "Radio Buttons", value: "Radio"},
                                               {  title: "Distress Thermometer", value: "DistressThermometer" } ]
                                            -->
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!--Assessment 4-->
                            <div id="ass4" *ngIf="assessments.assessmentType.toString() === '4'">
                                <div id="option-div-parent2">
                                </div>
                                <div id="btn-div-2">
                                    <div class="submit-child">
                                        <div [ngSwitch]="assessments.assessmentRequired">
                                            <button id="mandatory2" class="btn btn-primary" *ngSwitchCase="1" (click)="handleValidation('1', i)">
                                                Mandatory
                                            </button>
                                            <button id="optional2" class="btn btn-primary" *ngSwitchCase="0" (click)="handleValidation('0', i)">
                                                Optional
                                            </button>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary modal-order" (click)="open(content, i)">
                                            Order
                                    </button>
                                    <div ngbDropdown placement="top-right" class="d-inline-block">
                                        <button class="btn btn-primary" id="dropdownBasic2" ngbDropdownToggle>Toggle
                                            dropdown
                                        </button>
                                        <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                                            <button ngbDropdownItem (click)="handleDisplayTypes('Text', i)">Text Field
                                            </button>
                                            <button ngbDropdownItem (click)="handleDisplayTypes('Number', i)">Number
                                                Field
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </form>
            </cdk-virtual-scroll-viewport>
        </div>
        <ng-container>
            <div id="preview" *ngIf="tabView"
                 [@openPreview]="isOpen ? 'hidden' : 'visible'"
                 [@fullPreview]="fullPreview ? 'open' : 'close'"
            >
                <cdk-virtual-scroll-viewport style="height: 85vh" itemSize="90">
                    <app-preview></app-preview>
                </cdk-virtual-scroll-viewport>
            </div>
        </ng-container>
    </div>
</div>
